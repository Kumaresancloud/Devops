pipeline {
    agent { label 'awsuat-it-tfdeployer' }

    environment {
        REGION = 'us-east-1'
    }

    parameters {
        choice(name: 'ACCOUNT', choices: ['awsuat'], description: 'This pipeline only supports awsuat')
        choice(name: 'Region', choices: ['us-east-1'], description: 'AWS Region')
    }

    stages {
        stage('Prepare Script') {
            steps {
                echo "Selected Account: ${params.ACCOUNT}"
                echo "Region: ${params.Region}"
                sh 'chmod +x ./http/bash.sh'
            }
        }

        stage('Run HTTP-only Load Balancer Report') {
            steps {
                sh './http/bash.sh'
            }
        }
    }

    post {
        always {
            script {
                currentBuild.result = currentBuild.result ?: 'SUCCESS'
            }
            emailext (
                attachLog: true,
                subject: 'HTTP Load Balancer Report for awsuat',
                body: '''
                    <h3>HTTP-only Load Balancer Report for awsuat</h3>
                    <p>Build URL: ${BUILD_URL}</p>
                ''',
                attachmentsPattern: '*.csv',
                to: 'kumaresan_gopalakrishnan@glic.com'
            )
        }
    }
}
