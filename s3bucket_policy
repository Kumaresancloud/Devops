#!/bin/bash
echo "Fetching buckets with replication enabled..."
echo "Bucket Name,Replication Status" > replication_enabled_buckets.csv
# Get all S3 buckets
buckets=$(aws s3api list-buckets --query "Buckets[].Name" --output text)
# Loop through each bucket
for bucket in $buckets; do
   #replication=$(aws s3api get-bucket-replication --bucket "$bucket" --query "ReplicationConfiguration.Rules[].Status"  2>/dev/null)
   replication=$(aws s3api get-bucket-replication --bucket "$bucket" 2>/dev/null)
   if [ $? -eq 0 ]; then
       echo "$bucket,Enabled" >> replication_enabled_buckets.csv
   fi
done
echo "Done! See 'replication_enabled_buckets.csv'"
